FROM node:16

# Make a directory for the service
WORKDIR /usr/src/candles

# Install dependencies
COPY ./services/candles/entrypoint.sh ./
RUN apt-get -y update \
	&& apt-get -y install yarn \
	&& apt-get clean

# Install dependencies
ADD ./services/candles/package.json ./services/candles/yarn.lock ./
COPY ./libraries/parser ./libraries/parser/
RUN yarn add ./libraries/parser/TickerParserJs
RUN yarn

# Copy source code
COPY ./services/candles/app ./app

# Pass required credentials
ENV GOOGLE_APPLICATION_CREDENTIALS="/run/secrets/google-cloud-auth/key"

# Run
ENTRYPOINT ["bash", "./entrypoint.sh"]